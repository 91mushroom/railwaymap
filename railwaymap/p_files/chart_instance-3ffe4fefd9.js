/*!***********************************************
 Copyright (c) 2016, Neusoft Inc.
 All rights reserved
 图表秀 Version 1.0.0 2019.3.18
 ************************************************/
charting.factory("chartInstanceModel",function(){return{chartInstancesInfo:[{id:"1",version:"string",originId:"string",ownerId:"string",authorId:"string",author:"string",name:"string",description:"string",coverImageStore:"string",type:0,blcProductUrl:"string",creatTime:"Date",lastUpdate:"Date",isFrozen:!1,isDeleted:!1,isMyCoverImage:!1,sharing:null}],chartInstanceData:{id:"1",name:"string",createTime:"Date",lastUpdate:"Date",ownerId:"string",authorId:"string",author:"string",originId:"string",themeId:1,description:"string",version:"string",productUrl:"string",coverImageStore:"string",type:0,isFrozen:!1,isDeleted:!1,isMyCoverImage:!1,isSaveAs:!1,isTemp:!1,widget:[{define:{width:"number",height:"number"},resource:{id:null,name:null,version:null,category:null,desc:null,price:null,author:null,thumbnail:"url",codeStore:"url",interactive:3,crosstabAbility:1,dataCrosstab:1,options:[{category:"标题",props:[{title:"content",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"margin",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontFamily",type:"checkbox",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontSize",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontWeight",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontColor",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"副标题",props:[{title:"content",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"margin",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontFamily",type:"checkbox",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontSize",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontWeight",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontColor",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"图例",props:[{title:"绑定数据项",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"布局",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"透明度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图例项边距",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图标形状",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图标宽度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图标高度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字宽度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字号",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"粗斜体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字颜色",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"提示框",props:[{title:"背景色",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"边框宽度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"边框样式",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"圆角半径",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"对齐方式",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字号",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"粗斜体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字颜色",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"其它属性",props:[{title:"content",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"margin",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontFamily",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontSize",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontWeight",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontColor",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"}]}],userData:[["","Kia","Nissan","Toyota","Honda"],["2008",10,11,12,13],["2009",20,11,14,13],["2010",30,15,12,13]]}}]},convertDataToInfo:function(e){return{id:e.id,version:e.version,originId:e.originId,ownerId:e.ownerId,authorId:e.authorId,author:e.author,name:e.name,description:e.description,coverImageStore:e.coverImageStore,type:e.type,blcProductUrl:e.productUrl,creatTime:e.creatTime,lastUpdate:e.lastUpdate,isFrozen:e.isFrozen,isDeleted:e.isDeletd,isMyCoverImage:e.isMyCoverimage,sharing:e.sharing}}}}).factory("chartInstanceInfoResource",["$resource",function(e){var t=charts_server+"/service/charting/chartInstanceInfo/all",r={query:{method:"GET",isArray:!1}};return e(t,{},r)}]).factory("chartInstanceDataResource",["$resource",function(e){var t=charts_server+"/service/chartInstance/chartInstanceData/:id",r={update:{method:"PUT",params:{u:"@u"},isArray:!1}};return e(t,{},r)}]).factory("chartInstanceDataManager",["chartInstanceDataResource","$http","$q","chartInstanceModel","chartInstanceInfoManager","MediaLibraryManager",function(e,t,r,x,a,n){var i=x.chartInstanceData;return{getById:function(t){var a=r.defer();return i.id==t?a.resolve(i):e.get({id:t},function(e,t){if(e.error)a.reject(e.error);else{i=e.object;var r=i.widget.resource.userData;i.widget.resource.userData=JSON.parse(r),x.chartInstanceData=i,a.resolve(i)}},function(e,t){a.reject(e)}),a.promise},create:function(){var t=r.defer();return e.save({},function(e,r){e.error?t.reject(e.error):(i=e.object,t.resolve(i))},function(e,r){t.reject(e)}),t.promise},update:function(a,o,u){var l=r.defer();return e.update({u:o},a,function(e,r){e.error?l.reject(e.error):(u?(n.clearRefCount(),a.isMyCoverimage&&a.coverImageStore&&n.increaseRefCount(a.coverImageStore),t({method:"POST",url:charts_server+"/service/charting/resource/book/getlogoimg",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:"chartbook_id="+a.id}).then(function(e){var t=angular.copy(e.data.object);t&&n.increaseRefCount(t),n.updateRefCounts()})):n.updateRefCounts(),i=a,x.chartInstanceData=a,e.object?l.resolve(e.object):l.resolve())},function(e,t){l.reject(e)}),l.promise},updateCoverImage:function(e,t){i.id==e&&(i.coverImageStore=t)},"delete":function(x){var a=r.defer();return e["delete"]({id:x},function(e,r){if(e.error)a.reject(e.error);else{var x=e.object;n.clearRefCount(),_.each(x,function(e){e.isMyCoverimage&&e.coverImageStore&&n.decreaseRefCount(e.coverImageStore),t({method:"POST",url:charts_server+"/service/charting/resource/book/getlogoimg",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:"chartbook_id="+e.id}).then(function(e){var t=angular.copy(e.data.object);t&&n.decreaseRefCount(t),n.updateRefCounts()})}),a.resolve()}},function(e,t){a.reject(e)}),a.promise}}}]).factory("chartInstanceInfoManager",["chartInstanceInfoResource","favoritesResource","shareBooksInfoResource","$q","chartInstanceModel",function(e,t,r,x,a){var n=a.chartInstancesInfo;return{query:function(){var t=x.defer();return e.query(function(e){e.error?t.reject(e.error):(n=e.object,t.resolve(n))},function(e){t.reject(e)}),t.promise},queryCache:function(){var e=x.defer();return _.find(n,function(e){return"1"==e.id})?e.reject("请求出错"):e.resolve(n),e.promise},update:function(e){var t=a.convertDataToInfo(e),r=_.findIndex(n,function(e){return e.id===t.id});if(-1!=r){var x=n[r].sharing;t.sharing=x,n[r]=t}else n.push(t)},updateCoverImage:function(e,t){_.find(n,function(t){return t.id===e}).coverImageStore=t},"delete":function(e){var t=[];_.each(n,function(r){_.contains(e,r.id)||t.push(r)}),n=t}}}]);